# 变更提案: 渠道 Key 管理增强 + 模型重定向编辑修复

## 需求背景

当前管理界面存在两类问题：

1. **编辑渠道-模型重定向**：在编辑映射时，选择/切换源模型名会导致输入行消失，无法继续编辑（影响可用性）。
2. **API Key 管理能力不足**：缺少按 Key 维度的启用/禁用与描述信息；在“渠道编排”的 Key 列表中也无法直观看到描述或快速开关 Key。

## 变更内容

1. 修复“编辑渠道-模型重定向”输入行消失的问题，保证可稳定编辑/保存。
2. API Key 管理支持：
   - Key 启用/禁用（默认启用）
   - Key 描述（在编辑渠道弹窗内维护）
3. 渠道编排（Key 状态表）增强：
   - Key 后新增“描述”列
   - “连续失败”后新增“状态（启用/禁用开关）”列，可直接切换

## 影响范围

- **模块:**
  - 前端：渠道编辑弹窗、渠道编排列表
  - 后端：配置结构、Key 选择逻辑、Key 元信息更新接口
- **文件（预估）:**
  - `frontend/src/components/AddChannelModal.vue`
  - `frontend/src/components/ChannelOrchestration.vue`
  - `frontend/src/services/api.ts`
  - `backend-go/internal/config/*`
  - `backend-go/internal/handlers/*`
  - `backend-go/main.go`
- **API:**
  - 渠道列表/仪表盘接口新增字段：`apiKeyMeta`
  - 新增：Key 启用/禁用切换接口（按 channelId + keyIndex）
- **数据:**
  - `.config/config.json` 渠道配置新增 `apiKeyMeta`（兼容旧配置；缺省视为启用）

## 核心场景

### 需求: 修复模型重定向编辑
**模块:** 渠道编辑弹窗

#### 场景: 编辑现有映射
- 条件：进入“编辑渠道”，点击某条映射的“铅笔”进入编辑
- 操作：在“源模型名”下拉/输入中选择原模型名或其他模型名
- 预期结果：
  - 输入行不消失
  - 可正常修改目标模型名并保存

### 需求: Key 启用/禁用 + 描述
**模块:** 渠道编辑弹窗

#### 场景: 为 Key 添加描述并禁用
- 条件：编辑渠道，Key 列表存在多条 Key
- 操作：为某 Key 填写描述，切换为“禁用”，保存渠道
- 预期结果：
  - 描述与禁用状态持久化
  - 禁用的 Key 不参与实际转发选 Key

### 需求: 渠道编排 Key 表增强
**模块:** 渠道编排

#### 场景: 列表中查看描述并快速切换 Key
- 条件：进入渠道编排，展开某渠道的 Key 状态表
- 操作：查看 Key 描述；在“状态（启用/禁用）”列切换开关
- 预期结果：
  - Key 后显示描述
  - 切换开关后状态立即更新并持久化

## 风险评估

- **风险:** 配置兼容（旧配置无 `apiKeyMeta`）与回退策略不清晰
  - **缓解:** `apiKeyMeta` 缺省视为启用；后端读取时做默认值处理；写入仅在需要时补充字段
- **风险:** 禁用 Key 与熔断/冷却状态交互导致“启用但仍不选中”的困惑
  - **缓解:** 启用/禁用仅影响“是否参与选 Key”；熔断/冷却仍按现有机制展示与可手动重置
